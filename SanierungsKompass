import React, { useState } from "react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { motion } from "framer-motion";

export default function KlimaKompass() {
  const [plz, setPlz] = useState("");
  const [baujahr, setBaujahr] = useState("");
  const [heizung, setHeizung] = useState("");
  const [wohnflaeche, setWohnflaeche] = useState("");
  const [massnahme, setMassnahme] = useState("");
  const [showFoerderungen, setShowFoerderungen] = useState(false);
  const [expanded, setExpanded] = useState<number | null>(null);
  const [showPlanFor, setShowPlanFor] = useState<number | null>(null);

  // --- F√∂rder-Daten inkl. individueller Pl√§ne & Zeitachsen ---
  const foerderungen = [
    {
      key: "heizung",
      title: "Bundesf√∂rderung Heizung",
      summe: "bis zu 10.000 ‚Ç¨",
      details:
        "F√∂rderung f√ºr den Austausch alter √ñl- und Gasheizungen gegen erneuerbare Systeme (z. B. W√§rmepumpe).",
      plan: [
        { label: "Angebote & Vor-Ort-Check einholen", when: "Woche 1‚Äì2" },
        { label: "F√∂rderantrag stellen (digital)", when: "Woche 3" },
        { label: "Wartezeit Bewilligung", when: "Woche 4‚Äì8" },
        { label: "Installation & Inbetriebnahme", when: "Woche 9‚Äì12" },
        { label: "Verwendungsnachweis einreichen", when: "Woche 13‚Äì14" },
      ],
    },
    {
      key: "fenster",
      title: "F√∂rderung Wolfenb√ºttel",
      summe: "bis zu 8.000 ‚Ç¨",
      details:
        "F√∂rderungen f√ºr energieeffiziente Fenster (U‚â§1,0), Fassaden- und Dachd√§mmung ‚Äì kombinierbar mit iSFP-Bonus.",
      plan: [
        { label: "Energiecheck / U-Werte & Fl√§chen erfassen", when: "Woche 1" },
        { label: "Angebote von Fachbetrieben einholen", when: "Woche 2‚Äì3" },
        { label: "F√∂rderantrag & Nachweise vorbereiten", when: "Woche 4" },
        { label: "Ausf√ºhrung (Etappenweise m√∂glich)", when: "Woche 5‚Äì10" },
        { label: "Abnahme & Nachweis (Fotos/Rechnungen)", when: "Woche 11" },
      ],
    },
    {
      key: "nds",
      title: "Regionale F√∂rderung (Niedersachsen)",
      summe: "bis zu 3.000 ‚Ç¨",
      details:
        "Zusch√ºsse des Landes oder Landkreises (je nach PLZ) f√ºr erneuerbare Heizung, Fenster oder D√§mmung ‚Äì teils ohne Energieberater m√∂glich.",
      plan: [
        { label: "Programm pr√ºfen (Voraussetzungen/Fristen)", when: "Woche 1" },
        { label: "Kostenvoranschlag(e) beilegen & Antrag einreichen", when: "Woche 2" },
        { label: "Bewilligung abwarten", when: "Woche 3‚Äì6" },
        { label: "Ma√ünahme umsetzen (nach Bewilligung)", when: "Woche 7‚Äì12" },
        { label: "Verwendungsnachweis / Auszahlung", when: "Woche 13‚Äì14" },
      ],
    },
  ];

  const roadmap = [
    {
      step: "1. Analyse",
      info: "Energieverbrauch checken und erste Potenziale erkennen.",
    },
    {
      step: "2. F√∂rderung sichern",
      info: "Passende F√∂rderungen beantragen ‚Äì regional und bundesweit.",
    },
    {
      step: "3. Umsetzung",
      info: "Ma√ünahmen umsetzen und langfristig Energiekosten sparen.",
    },
  ];

  const printPDF = () => {
    // Einfacher PDF-Export √ºber den Browser-Druckdialog
    window.print();
  };

  return (
    <div className="min-h-screen flex flex-col">
      {/* Header */}
      <header className="w-full bg-green-700 text-white p-4 flex justify-between items-center shadow-md">
        <h1 className="text-2xl font-bold">KlimaKompass</h1>
        <nav className="space-x-6">
          <a href="#home" className="hover:underline">Home</a>
          <a href="#foerdercheck" className="hover:underline">F√∂rdercheck</a>
          <a href="#roadmap" className="hover:underline">Roadmap</a>
          <a href="#about" className="hover:underline">√úber uns</a>
        </nav>
      </header>

      {/* Hero Section */}
      <section id="home" className="bg-green-50 py-20 text-center relative">
        <h2 className="text-4xl font-bold mb-4">Damit jedes Zuhause zukunftssicher wird</h2>
        <p className="text-lg mb-6 text-gray-700">
          Dein digitaler Begleiter f√ºr Sanierung, F√∂rderungen und Energiekosten-Ersparnis.
        </p>
        <Button onClick={() => document.getElementById("foerdercheck")?.scrollIntoView({behavior:'smooth'})}>
          Jetzt F√∂rdercheck starten
        </Button>

        {/* Igel Maskottchen */}
        <motion.div
          initial={{ y: 20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ duration: 1 }}
          className="absolute right-10 bottom-0 w-40"
        >
          <img
            src="https://upload.wikimedia.org/wikipedia/commons/6/6f/Cartoon_Hedgehog.svg"
            alt="Ely Igel"
          />
          <div className="bg-white rounded-xl shadow-md p-2 text-sm mt-2">
            Hi, ich bin Ely ü¶î ‚Äì dein Energiespar-Guide!
          </div>
        </motion.div>
      </section>

      {/* F√∂rdercheck */}
      <section id="foerdercheck" className="py-16 px-6 bg-white max-w-4xl mx-auto w-full">
        <h3 className="text-2xl font-bold mb-6 text-center">F√∂rdercheck</h3>
        <div className="grid grid-cols-2 gap-4">
          <input
            className="border rounded p-2"
            placeholder="Postleitzahl"
            value={plz}
            onChange={(e) => setPlz(e.target.value)}
          />
          <input
            className="border rounded p-2"
            placeholder="Baujahr"
            value={baujahr}
            onChange={(e) => setBaujahr(e.target.value)}
          />
          <input
            className="border rounded p-2"
            placeholder="Heizungstyp"
            value={heizung}
            onChange={(e) => setHeizung(e.target.value)}
          />
          <input
            className="border rounded p-2"
            placeholder="Wohnfl√§che (qm)"
            value={wohnflaeche}
            onChange={(e) => setWohnflaeche(e.target.value)}
          />
          <select
            className="border rounded p-2 col-span-2"
            value={massnahme}
            onChange={(e) => setMassnahme(e.target.value)}
          >
            <option value="">Ma√ünahme ausw√§hlen</option>
            <option value="daemmung">D√§mmung</option>
            <option value="fenster">Fenster</option>
            <option value="pv">Photovoltaik</option>
            <option value="heizung">Heizung</option>
          </select>
        </div>
        <div className="text-center mt-6">
          <Button onClick={() => setShowFoerderungen(true)}>Ergebnisse anzeigen</Button>
        </div>

        {showFoerderungen && (
          <>
            <div className="mt-10 grid gap-4">
              {foerderungen.map((f, i) => (
                <Card key={f.key} className="shadow-md">
                  <CardContent className="p-4">
                    <div className="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                      <div>
                        <h4 className="font-bold">{f.title}</h4>
                        <p className="text-green-700 font-semibold">{f.summe}</p>
                      </div>
                      <div className="flex gap-2">
                        <Button variant="outline" onClick={() => setExpanded(expanded === i ? null : i)}>
                          {expanded === i ? "Weniger Infos" : "Mehr Infos"}
                        </Button>
                        <Button onClick={() => setShowPlanFor(i)}>F√∂rderplan anzeigen</Button>
                      </div>
                    </div>
                    {expanded === i && (
                      <motion.p
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        className="mt-3 text-gray-700"
                      >
                        {f.details}
                      </motion.p>
                    )}
                  </CardContent>
                </Card>
              ))}
            </div>

            {/* Individueller Plan pro F√∂rderung */}
            {showPlanFor !== null && (
              <div className="mt-8 p-5 border rounded-xl bg-green-50 text-gray-800 print:bg-white">
                <h4 className="font-bold mb-2">
                  Dein F√∂rderplan: {foerderungen[showPlanFor].title}
                </h4>
                <ul className="list-disc ml-6 space-y-1">
                  {foerderungen[showPlanFor].plan.map((p, idx) => (
                    <li key={idx}>
                      <span className="font-medium">{p.when}:</span> {p.label}
                    </li>
                  ))}
                </ul>
                <div className="flex gap-3 mt-4">
                  <Button variant="outline" onClick={() => setShowPlanFor(null)}>Plan schlie√üen</Button>
                  <Button onClick={printPDF}>PDF generieren</Button>
                </div>
                <p className="text-xs text-gray-600 mt-2">Hinweis: Der PDF-Export nutzt den Druck-Dialog deines Browsers.</p>
              </div>
            )}
          </>
        )}
      </section>

      {/* Roadmap */}
      <section id="roadmap" className="bg-green-50 py-16 px-6">
        <h3 className="text-2xl font-bold mb-6 text-center">Deine Roadmap</h3>
        <div className="relative border-l-2 border-green-500 max-w-3xl mx-auto">
          {roadmap.map((r, i) => (
            <div key={i} className="mb-8 ml-4">
              <div className="absolute w-3 h-3 bg-green-500 rounded-full -left-1.5 mt-2"></div>
              <h4 className="font-bold">{r.step}</h4>
              <p className="text-gray-700">{r.info}</p>
            </div>
          ))}
        </div>
      </section>

      {/* Footer */}
      <footer className="bg-green-700 text-white text-center py-6 mt-auto">
        <h4 className="text-lg font-bold">Bereit f√ºr deine Sanierung?</h4>
        <p className="mb-4">Lass dich von Ely ü¶î Schritt f√ºr Schritt begleiten.</p>
        <Button variant="secondary" onClick={() => document.getElementById("foerdercheck")?.scrollIntoView({behavior:'smooth'})}>F√∂rdercheck starten</Button>
      </footer>
    </div>
  );
}
